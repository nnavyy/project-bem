generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Mahasiswa {
  id        String    @id @default(uuid())
  nim       String    @unique
  nama      String
  email     String?
  password  String
  jurusan   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  laporan   Laporan[]
}

model Laporan {
  id           String        @id @default(uuid())
  judul        String
  isi          String
  status       StatusLaporan @default(PENDING)
  mahasiswaId  String
  tindaklanjut String?
  ditindakOleh String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  adminTindak  Admin?        @relation("AdminTindakLaporan", fields: [ditindakOleh], references: [id])
  mahasiswa    Mahasiswa     @relation(fields: [mahasiswaId], references: [id])
}

model TokenAdmin {
  id           String              @id @default(uuid())
  token        String              @unique
  isUsed       Boolean             @default(false)
  adminId      String?
  generatedBy  String?
  expiredAt    DateTime?
  isPermanent  Boolean             @default(false)
  createdAt    DateTime            @default(now())
  usedAt       DateTime?
  logAktivitas LogAktivitasAdmin[] @relation("TokenActivity")
  admin        Admin?              @relation("TokenOwner", fields: [adminId], references: [id])
  headAdmin    Admin?              @relation("TokenGenerator", fields: [generatedBy], references: [id])
}

model Blog {
  id        String   @id @default(uuid())
  judul     String
  isi       String
  gambar    String?
  penulisId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  penulis   Admin    @relation(fields: [penulisId], references: [id])
}

model Portofolio {
  id          String    @id @default(uuid())
  namaDivisi  String
  deskripsi   String
  fotoUtama   String?   // bisa jadi banner atau gambar utama divisi
  tanggal     DateTime? @default(now())
  adminId     String
  admin       Admin     @relation(fields: [adminId], references: [id])
  galeri      Galeri[]  // relasi ke anggota / foto divisi
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Galeri {
  id            String     @id @default(uuid())
  portofolioId  String
  namaAnggota   String
  jabatan       String?
  foto          String?
  portofolio    Portofolio @relation(fields: [portofolioId], references: [id], onDelete: Cascade)
}

model LogAktivitasAdmin {
  id         String      @id @default(uuid())
  adminId    String
  tokenId    String?
  waktuLogin DateTime    @default(now())
  ipAddress  String?
  admin      Admin       @relation(fields: [adminId], references: [id])
  token      TokenAdmin? @relation("TokenActivity", fields: [tokenId], references: [id])
}

model Admin {
  id             String              @id
  username       String              @unique
  nama           String
  role           RoleAdmin           @default(ADMIN)
  password       String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime
  blog           Blog[]
  laporanTindak  Laporan[]           @relation("AdminTindakLaporan")
  logAktivitas   LogAktivitasAdmin[]
  portofolio     Portofolio[]
  tokenAdmin     TokenAdmin[]        @relation("TokenOwner")
  generatedToken TokenAdmin[]        @relation("TokenGenerator")
}

enum StatusLaporan {
  PENDING
  DIBACA
  DITINDAKLANJUTI
  SELESAI
}

enum RoleAdmin {
  ADMIN
  HEAD_ADMIN
}
